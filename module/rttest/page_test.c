#include "rttest.h"
#include <mm/page.h>
#include <generated/autoconf.h>

#define CHECK_RESULT(condition) do                              \
                                {                               \
                                        if(condition)           \
                                                (*success)++;   \
                                        else                    \
                                                (*error)++;     \
                                } while(0)


int rt_page_api(int* success, int* error)
{
#if (CONFIG_PAGE_OFFSET == 12)
	CHECK_RESULT(PAGE_OFFSET == 12);
	CHECK_RESULT(PAGE_SIZE == 4096);
	CHECK_RESULT(PAGE_ALIGN_BIT == 0b111111111111);
	CHECK_RESULT(PAGE_UPPER_ALIGN(0x1000) == 0x1000);
	CHECK_RESULT(PAGE_UPPER_ALIGN(0x1001) == 0x2000);
	CHECK_RESULT(PAGE_UPPER_ALIGN(0x1fff) == 0x2000);
	CHECK_RESULT(PAGE_UPPER_ALIGN(0x2000) == 0x2000);
	CHECK_RESULT(PAGE_UPPER_ALIGN(0x1f3a) == 0x2000);
	CHECK_RESULT(PAGE_DOWNS_ALIGN(0x1f3a) == 0x1000);
	CHECK_RESULT(PAGE_DOWNS_ALIGN(0x1fff) == 0x1000);
	CHECK_RESULT(PAGE_DOWNS_ALIGN(0x2fff) == 0x2000);
	CHECK_RESULT(PAGE_DOWNS_ALIGN(0x2000) == 0x2000);
	CHECK_RESULT(PAGE_DOWNS_ALIGN(0x1000) == 0x1000);
	CHECK_RESULT(PAGE_DOWNS_ALIGN(0x1001) == 0x1000);
	
	CHECK_RESULT(PA_PAGE_ALIGNED(0x1000) == 1);
	CHECK_RESULT(PA_PAGE_ALIGNED(0x123f) == 0);
	CHECK_RESULT(PA_PAGE_ALIGNED(0x1314000) == 1);
	CHECK_RESULT(PA_PAGE_ALIGNED(0x1314001) == 0);
	CHECK_RESULT(PA_PAGE_ALIGNED(0x1314fff) == 0);
	CHECK_RESULT(PA_PAGE_ALIGNED(0x1314ac0) == 0);
	CHECK_RESULT(PA_PAGE_ALIGNED(0x1314a00) == 0);
	CHECK_RESULT(PA_PAGE_ALIGNED(0x1314a0c) == 0);
	CHECK_RESULT(PA_PAGE_ALIGNED(0x13140cc) == 0);
	CHECK_RESULT(PA_PAGE_ALIGNED(0x13140c0) == 0);
	CHECK_RESULT(PA_PAGE_ALIGNED(0x1314001) == 0);
	CHECK_RESULT(PA_PAGE_ALIGNED(0x1000001) == 0);
	
	CHECK_RESULT(VA_PAGE_ALIGNED(0x1000) == 1);
	CHECK_RESULT(VA_PAGE_ALIGNED(0x123f) == 0);
	CHECK_RESULT(VA_PAGE_ALIGNED(0x1314000) == 1);
	CHECK_RESULT(VA_PAGE_ALIGNED(0x1314001) == 0);
	CHECK_RESULT(VA_PAGE_ALIGNED(0x1314fff) == 0);
	CHECK_RESULT(VA_PAGE_ALIGNED(0x1314ac0) == 0);
	CHECK_RESULT(VA_PAGE_ALIGNED(0x1314a00) == 0);
	CHECK_RESULT(VA_PAGE_ALIGNED(0x1314a0c) == 0);
	CHECK_RESULT(VA_PAGE_ALIGNED(0x13140cc) == 0);
	CHECK_RESULT(VA_PAGE_ALIGNED(0x13140c0) == 0);
	CHECK_RESULT(VA_PAGE_ALIGNED(0x1314001) == 0);
	CHECK_RESULT(VA_PAGE_ALIGNED(0x1000001) == 0);
	
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x1000) == 1);
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x123f) == 0);
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x1314000) == 1);
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x1314001) == 0);
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x1314fff) == 0);
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x1314ac0) == 0);
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x1314a00) == 0);
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x1314a0c) == 0);
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x13140cc) == 0);
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x13140c0) == 0);
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x1314001) == 0);
	CHECK_RESULT(VAL_IS_PAGE_ALIGNED(0x1000001) == 0);
#else
	CHECK_RESULT(PAGE_OFFSET == CONFIG_PAGE_OFFSET);
        CHECK_RESULT(PAGE_SIZE == (1ull << CONFIG_PAGE_OFFSET));
	CHECK_RESULT(PAGE_ALIGN_BIT == ((1ull << CONFIG_PAGE_OFFSET) -1));
#endif 
	return 0;
}

