#include "rttest.h"
#include <aco/errno.h>
#include <mm/page.h>

#define CHECK(condition) 	do 				\
				{				\
					if(condition)		\
						(*success)++;	\
					else			\
						(*error)++;	\
				} while(0)


int rt_page_api(int* success, int* error)
{
	CHECK(PAGE_SIZE == (1L << PAGE_OFFSET));
	CHECK(PAGE_ALIGN_BIT == (PAGE_SIZE -1));
	CHECK(VAL_IS_PAGE_ALIGNED(0x78923) == PA_PAGE_ALIGNED(0x78923));
	CHECK(VAL_IS_PAGE_ALIGNED(0x78923) == VA_PAGE_ALIGNED(0x78923));
	CHECK(PA_PAGE_ALIGNED(0x78923) == VA_PAGE_ALIGNED(0x78923));
#if (PAGE_OFFSET == 12)
	CHECK(PAGE_SIZE == 4096);
	CHECK(PAGE_ALIGN_BIT == ((1L << 12)-1));
	CHECK(PAGE_UPPER_ALIGN(0x1000) == 0x1000);
	CHECK(PAGE_UPPER_ALIGN(0x1001) == 0x2000);
	CHECK(PAGE_UPPER_ALIGN(0x729231) == 0x72a000);
	CHECK(PAGE_UPPER_ALIGN(0x721fff) == 0x722000);
	CHECK(PAGE_UPPER_ALIGN(0x721000) == 0x721000);
	CHECK(PAGE_DOWNS_ALIGN(0x2000) == 0x2000);
	CHECK(PAGE_DOWNS_ALIGN(0x2001) == 0x2000);
	CHECK(PAGE_DOWNS_ALIGN(0x2fff) == 0x2000);
	CHECK(PAGE_DOWNS_ALIGN(0x31afff) == 0x31a000);
	CHECK(PAGE_DOWNS_ALIGN(0x31a234) == 0x31a000);
	CHECK(PA_PAGE_ALIGNED(0x1000) == 1);
	CHECK(PA_PAGE_ALIGNED(0x1001) == 0);
	CHECK(PA_PAGE_ALIGNED(0x1fff) == 0);
	CHECK(PA_PAGE_ALIGNED(0x1234) == 0);
	CHECK(PA_PAGE_ALIGNED(0x2371234) == 0);
	CHECK(PA_PAGE_ALIGNED(0x2000234) == 0);
	CHECK(PA_PAGE_ALIGNED(0x2000000) == 1);
	CHECK(VA_PAGE_ALIGNED(0x1000) == 1);
	CHECK(VA_PAGE_ALIGNED(0x1001) == 0);
	CHECK(VA_PAGE_ALIGNED(0x1fff) == 0);
	CHECK(VA_PAGE_ALIGNED(0x1234) == 0);
	CHECK(VA_PAGE_ALIGNED(0x2371234) == 0);
	CHECK(VA_PAGE_ALIGNED(0x2000234) == 0);
	CHECK(VA_PAGE_ALIGNED(0x2000000) == 1);
	CHECK(VAL_IS_PAGE_ALIGNED(0x1000) == 1);
	CHECK(VAL_IS_PAGE_ALIGNED(0x1001) == 0);
	CHECK(VAL_IS_PAGE_ALIGNED(0x1fff) == 0);
	CHECK(VAL_IS_PAGE_ALIGNED(0x1234) == 0);
	CHECK(VAL_IS_PAGE_ALIGNED(0x2371234) == 0);
	CHECK(VAL_IS_PAGE_ALIGNED(0x2000234) == 0);
	CHECK(VAL_IS_PAGE_ALIGNED(0x2000000) == 1);
#endif
	return 0;
}
